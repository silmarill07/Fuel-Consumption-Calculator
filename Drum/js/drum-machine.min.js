jQuery(document).ready(function (e) {
    var t, n, a = new(window.AudioContext || window.webkitAudioContext),
            i = 0,
            s = 0,
            r = !1,
            o = 90,
            l = DRUM_MACHINE_TRANSLATION,
            h = l.buttonNames,
            c = [],
            m = _.extend({
                    EventKeys: {},
                    register: function (e) {
                            for (var t in e) {
                                    if (t in this.EventKeys) throw "Dispatcher error: duplicate event key: " + t;
                                    this.EventKeys[t] = e[t]
                            }
                    }
            }, Backbone.Events),
            d = !1;
    (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0, 4))) && (d = !0);
    var u = function (e) {
            var t = {},
                    n = 0,
                    a = 0;

            function i() {
                    console.warn("Need to pass a callback to load()")
            }
            function s(e, s) {
                    s ? (t[e] = s, ++n == a && i()) : console.error("Unable to decode audio file", url)
            }
            function r(t, n) {
                    var a = new XMLHttpRequest;
                    a.responseType = "arraybuffer",
                    a.onload = function () {
                            e.decodeAudioData(a.response, function (e) {
                                    s(t, e)
                            }, function (e) {
                                    console.error("Unable to decode audio data", e)
                            })
                    },
                    a.onerror = function (e) {
                            console.error("Error loading sample data", t, n, e)
                    },
                    a.open("GET", n, !0),
                    a.send()
            }
            return {
                    play: function (n, a) {
                            var i = e.createBufferSource();
                            i.buffer = t[n],
                            i.connect(e.destination),
                            i.start(a || 0)
                    },
                    init: function (e, t) {
                            for (var n in e) a++;
                            for (var n in e) r(n, e[n]);
                            i = t
                    }
            }
    }(a),
            p = function (n, a) {
                    var h, d, u, p, v = {
                            SEQUENCER_PLAY: "sequencer:play",
                            SEQUENCER_STOP: "sequencer:stop",
                            SEQUENCER_SET_PATTERN: "sequencer:setpattern",
                            SEQUENCER_SET_PATTERN_FROM_TACT: "sequencer:settPatternFromTact",
                            SEQUENCER_PATTERN_CHANGED: "sequencer:patternchanged",
                            SEQUENCER_STEP: "sequencer:step",
                            SEQUENCER_NOTE_PLAY: "sequencer:noteplay"
                    },
                            g = !1,
                            E = 0,
                            T = !1,
                            f = null,
                            w = {};

                    function C(e) {
                            d = 60 / (h = e) / 4,
                            t && (d = "5/4" == t.rhythm || "6/8" == t.rhythm ? 60 / h / 2.000000000000002 : 60 / h / 4)
                    }
                    function b() {
                            if (!T) return !1;
                            var e = n.currentTime;
                            (e -= p, 0 === n.currentTime && (u -= p), u < e + .2) && (!
                            function (e) {
                                    var n = t.rhythm,
                                            i = f.hihat.length;
                                    for (var s in f)!1 !== w[s] && r && ("4/4" === n || "3/4" === n ? (E % 4 == 3 && (15 === E ? E = 0 : E++), "3/4" === n && 12 === E && E++) : "5/4" !== n && "6/8" !== n || E % 2 == 0 && (u += d / 6), E >= i + 1 && (E = 0)),
                                    !1 !== w[s] && "1" == f[s][E] ? (a.play(s, e), m.trigger(m.EventKeys.SEQUENCER_NOTE_PLAY, s)) : !1 !== w[s] && "2" === f[s][E] && ("hihat" === s ? a.play("aabenhihat", e) : "sidetamlys" === s ? a.play("sidetamdyb", e) : "lilletromme" === s && a.play("kantslag", e), m.trigger(m.EventKeys.SEQUENCER_NOTE_PLAY, s)),
                                    m.trigger(m.EventKeys.SEQUENCER_STEP, E)
                            }(u + p), function () {
                                    E++;
                                    var e = f.hihat.length;
                                    E >= e && (E = 0);
                                    u += d
                            }());
                            setTimeout(b, 0)
                    }
                    function S(e, t) {
                            if (!g) throw "Sequencer not initialized";
                            null === f && R(e),
                            void 0 === t && (t = 1),
                            -1 === t && (t = Number.MAX_INT),
                            T = !0,
                            u = 0,
                            p = n.currentTime + .005,
                            b()
                    }
                    function R(e) {
                            for (var t in f = {}, _.extend(e.sequence, {}), _currentPatternSequenceRawAdditional = _.extend(e.sequence_additional, {}), e.sequence) {
                                    var n = e.sequence[t].split("");
                                    f[t] = n
                            }
                    }
                    var P, k = Handlebars.compile('        <div class="module sequencer">            <div class="sequencer-channels">                {{#each channels}}                    <div class="channel" data-inst="{{ this }}" data-count="{{ @index }}"></div>                {{/each}}             </div>        </div>'),
                            N = {},
                            q = {},
                            A = Backbone.View.extend({
                                    channelViews: {},
                                    initialize: function (e) {
                                            this.listenTo(m, m.EventKeys.SEQUENCER_PLAY, S),
                                            this.listenTo(m, m.EventKeys.SEQUENCER_STOP, this.stop),
                                            this.listenTo(m, m.EventKeys.SEQUENCER_SET_PATTERN, this.setPattern),
                                            this.listenTo(m, m.EventKeys.SEQUENCER_SET_PATTERN_FROM_TACT, this.settPatternFromTact),
                                            this.listenTo(m, m.EventKeys.SEQUENCER_SET_TEMPO, C),
                                            this.listenTo(m, m.EventKeys.SEQUENCER_STEP, this.setPlayhead),
                                            this.listenTo(m, m.EventKeys.SEQUENCER_NOTE_PLAY, this.onNotePlay)
                                    },
                                    settPatternFromTact: function (e) {
                                            for (var n in R(e), this.render(), t = e, N = {}, this.channelViews) this.channelViews[n].remove();
                                            for (var n in f) {
                                                    var a = this.$el.find('.channel[data-inst="' + n + '"]');
                                                    this.channelViews[n] = new B({
                                                            channel: n,
                                                            model: f[n],
                                                            el: a,
                                                            pattern_name: l.patternName[n],
                                                            muted: e.muted[n],
                                                            rhythm: e.rhythm
                                                    })
                                            }
                                            this.renderChannels()
                                    },
                                    setPattern: function (e) {
                                            R(e),
                                            this.render(),
                                            t = e;
                                            var n = 0;
                                            for (var a in this.channelViews) this.channelViews[a].remove();
                                            for (var a in f) {
                                                    var i = this.$el.find('.channel[data-inst="' + a + '"]');
                                                    this.channelViews[a] = new B({
                                                            channel: a,
                                                            model: f[a],
                                                            el: i,
                                                            pattern_name: l.patternName[a],
                                                            muted: e.muted[n],
                                                            rhythm: e.rhythm
                                                    }),
                                                    n++
                                            }
                                            this.renderChannels(),
                                            y()
                                    },
                                    render: function () {
                                            var e = f ? Object.keys(f) : [],
                                                    t = k({
                                                            channels: e
                                                    });
                                            return this.$el.html(t),
                                            this
                                    },
                                    renderChannels: function () {
                                            for (var t in this.$channelContainer = this.$el.find(".sequencer-channels"), this.channelViews) this.channelViews[t].render();
                                            this.$steps = e(".channel span")
                                    },
                                    setPlayhead: function (e) {
                                            for (var t in this.channelViews) this.channelViews[t].setPlayhead(e)
                                    },
                                    stop: function () {
                                            for (var t in T = !1, E = 0, e("#play").attr("class", "btn-play"), m.trigger(m.EventKeys.SEQUENCER_STEP, E), this.channelViews) this.channelViews[t].clearPlayhead()
                                    }
                            }),
                            O = Handlebars.compile('        <p class="seq-row-name mute active" title="{{ pattern_name }}">        <span class="desktop--show">{{ pattern_name }}</span>        </p>          <div class="seq-row inline">              {{#each notes}}            <span data-tic="{{ @index }}" class=""></span>            {{/each}}         </div>        '),
                            B = Backbone.View.extend({
                                    events: {
                                            "click .seq-row span": "onNoteClick",
                                            "click .pad": "onPadClick",
                                            "click .mute": "onMuteClick"
                                    },
                                    channel: null,
                                    active: !0,
                                    initialize: function (e) {
                                            this.channel = e.channel,
                                            this.pattern_name = e.pattern_name,
                                            this.muted = e.muted,
                                            this.rhythm = e.rhythm
                                    },
                                    render: function () {
                                            var t = O({
                                                    id: this.channel,
                                                    symbol: this.channel.substr(0, 1).toUpperCase(),
                                                    word: this.channel,
                                                    notes: this.model,
                                                    pattern_name: this.pattern_name
                                            });
                                            this.$el.html(t),
                                            this.$notes = this.$el.find(".seq-row span"),
                                            this.$eq_bar = this.$el.find(".meter span"),
                                            this.$active = this.$el.find(".mute");
                                            var n = this,
                                                    a = 1;
                                            return this.model.forEach(function (e, t) {
                                                    var i = n.$notes.eq(t);
                                                    "1" === e ? (i.addClass("seq-note"), N[n.el.dataset.count + ":" + t] = n.el.dataset.count + "." + t + "." + e) : "2" === e && "hihat" == n.channel || "2" === e && "sidetamlys" == n.channel || "2" === e && "lilletromme" == n.channel ? (i.addClass("seq-note-yellow"), N[n.el.dataset.count + ":" + t] = n.el.dataset.count + "." + t + "." + e) : "3" === e ? i.addClass("seq-note-empty") : delete N[n.el.dataset.count + ":" + t],
                                                    "4/4" == n.rhythm || "3/4" == n.rhythm ? (t % 4 == 0 && i.addClass("seq-step-measure").html(t / 4 + 1), r && t % 4 == 3 && i.hide()) : "5/4" != n.rhythm && "6/8" != n.rhythm || t % 2 == 0 && i.addClass("seq-step-measure").html(a++),
                                                    c = Object.values(N)
                                            }),
                                            this.active ? delete q[n.el.dataset.count] : q[n.el.dataset.count] = n.el.dataset.count,
                                            this.muted ? (this.$active.toggleClass("active", !this.active), this.$notes.toggleClass("seq-active", !this.active), w[this.channel] = !this.active, q[n.el.dataset.count] = n.el.dataset.count, this.active || delete q[n.el.dataset.count]) : (this.$active.toggleClass("active", this.active), this.$notes.toggleClass("seq-active", this.active), w[this.channel] = this.active),
                                            c.push("m." + Object.values(q).join("")),
                                            r ? (P = "s.1", e(".swing").removeClass("swing-disabled")) : (P = "s.0", e(".swing").addClass("swing-disabled")),
                                            c.push("t." + this.rhythm.slice(0, 1)),
                                            c.push("tmp." + o),
                                            c.push(P),
                                            this
                                    },
                                    clearPlayhead: function () {
                                            this.$notes.removeClass("seq-playhead")
                                    },
                                    setPlayhead: function (e) {
                                            this.clearPlayhead(),
                                            this.$notes.filter('[data-tic="' + e + '"]').addClass("seq-playhead")
                                    },
                                    onNoteClick: function (t) {
                                            var n = e(t.currentTarget).attr("data-tic");
                                            "hihat" == this.channel || "sidetamlys" == this.channel || "lilletromme" == this.channel ? f[this.channel][n] = "0" === f[this.channel][n] ? "1" : f[this.channel][n] = "1" === f[this.channel][n] ? "2" : f[this.channel][n] = (f[this.channel][n], "0") : f[this.channel][n] = "1" === f[this.channel][n] ? "0" : "1",
                                            "1" === f[this.channel][n] ? (s += 1) >= 1 && e(".clearBtn").removeClass("clearBtn-disabled") : "0" === f[this.channel][n] && (s -= 1),
                                            this.render(),
                                            y()
                                    },
                                    onMuteClick: function (t) {
                                            this.active = !this.active,
                                            w[this.channel] = this.active,
                                            this.$active.toggleClass("active", this.active),
                                            this.$notes.toggleClass("seq-active", this.active),
                                            i++,
                                            this.active && i--,
                                            i >= 1 && e(".clearBtn").removeClass("clearBtn-disabled"),
                                            this.render(),
                                            y()
                                    },
                                    spikeEQ: function () {
                                            var e = this;
                                            this.$eq_bar.removeClass("fade"),
                                            this.$eq_bar.css("transform", "scaleX(1)"),
                                            setTimeout(function () {
                                                    e.$eq_bar.addClass("fade"),
                                                    e.$eq_bar.css("transform", "scaleX(0)")
                                            }, 50)
                                    }
                            });
                    return {
                            init: function (e) {
                                    m.register(v),
                                    new A(e).render(),
                                    C(90),
                                    g = !0
                            }
                    }
            }(a, u),
            v = function () {
                    var a = {
                            TRANSPORT_PLAY: "transport:play",
                            TRANSPORT_STOP: "transport:stop",
                            TRANSPORT_CLEAR: "transport:clear",
                            TRANSPORT_REQUEST_PLAY: "transport:requestplay",
                            TRANSPORT_REQUEST_STOP: "transport:requeststop",
                            TRANSPORT_REQUEST_MUTE: "transport:requestmute",
                            TRANSPORT_TEMPO_CHANGED: "transport:tempochanged",
                            TRANSPORT_CHANGE_TEMPO: "transport:changetempo"
                    },
                            u = {
                                    sequence: {
                                            hihatfod: "0000000000000000",
                                            sidetamlys: "0000000000000000",
                                            gulvtam: "0000000000000000",
                                            ride: "0000000000000000",
                                            hihat: "0000000000000000",
                                            lilletromme: "0000000000000000",
                                            stortromme: "0000000000000000"
                                    },
                                    muted: {},
                                    swing: !1,
                                    rhythm: "4/4"
                            },
                            p = {
                                    sequence: {
                                            hihatfod: "000000000000",
                                            sidetamlys: "000000000000",
                                            gulvtam: "000000000000",
                                            ride: "000000000000",
                                            hihat: "000000000000",
                                            lilletromme: "000000000000",
                                            stortromme: "000000000000"
                                    },
                                    muted: {},
                                    swing: !1,
                                    rhythm: "3/4"
                            },
                            v = {
                                    sequence: {
                                            hihatfod: "0000000000",
                                            sidetamlys: "0000000000",
                                            gulvtam: "0000000000",
                                            ride: "0000000000",
                                            hihat: "0000000000",
                                            lilletromme: "0000000000",
                                            stortromme: "0000000000"
                                    },
                                    muted: {},
                                    swing: !1,
                                    rhythm: "5/4"
                            },
                            g = {
                                    sequence: {
                                            hihatfod: "000000000000",
                                            sidetamlys: "000000000000",
                                            gulvtam: "000000000000",
                                            ride: "000000000000",
                                            hihat: "000000000000",
                                            lilletromme: "000000000000",
                                            stortromme: "000000000000"
                                    },
                                    muted: {},
                                    swing: !1,
                                    rhythm: "6/8"
                            },
                            E = Handlebars.compile('<div class="module transport"><div class="module-wrapper"><div class="module-inner"><button id="play" class="btn-play" title="Play/Pause">&ensp;</button><input type="text" name="tempo" size="4" min="30" max="250" maxlength="3" step="10" value="90" class="transport-tempo"><button class="swing swing-disabled">' + h.swing + '</button><nav class="navigation-wrapper-tact"><button class="beatTime dropButton">Taktart</button><nav><ul id="beatDropdown" class="menu dropdown-content-takt dropdown-content"><li><a class="set-beat" data-beat="3/4" href="#">3/4</a></li><li><a class="set-beat" data-beat="4/4" href="#">4/4</a></li><li><a class="set-beat" data-beat="5/4" href="#">5/4</a></li><li><a class="set-beat" data-beat="6/8" href="#">6/8</a></li></ul></nav></nav><nav class="navigation-wrapper"><button class="presetsBtn dropButton">' + h.presetsButtonName + '</button><nav class="navigation"></nav></nav><button class="clearBtn">' + h.reset + "</button></div></div></div>");

                    function T() {
                            m.trigger(m.EventKeys.TRANSPORT_REQUEST_PLAY)
                    }
                    function f() {
                            m.trigger(m.EventKeys.TRANSPORT_REQUEST_STOP)
                    }
                    var w = Backbone.View.extend({
                            events: {
                                    "click .btn-play, .btn-pause": function (t) {
                                            e(t.target).toggleClass("btn-play btn-pause")
                                    },
                                    "click .btn-play": "onPlayClick",
                                    "click .btn-pause": "onStopClick",
                                    "change .transport-tempo": "onTempoChange",
                                    "click .swing": "onSwingClick",
                                    "click .clearBtn": "onClearBtnClick",
                                    "click .set-beat": "onSetBeatClick",
                                    "touchstart .set-beat": "onSetBeatClick",
                                    "touchstart .beatTime": "onBeatClick",
                                    "touchstart .presetsBtn": "onBeatClick",
                                    "mouseover .presetsBtn": "onSetBeatIn",
                                    "mouseout .presetsBtn": "onSetBeatOut",
                                    "mouseover .navigation-wrapper-tact": "onSetBeatIn",
                                    "mouseout .navigation-wrapper-tact": "onSetBeatOut",
                                    "mouseover .navigation-wrapper": "onSetBeatIn",
                                    "mouseout .navigation-wrapper": "onSetBeatOut"
                            },
                            initialize: function (t) {
                                    this.listenTo(m, m.EventKeys.TRANSPORT_PLAY, T),
                                    this.listenTo(m, m.EventKeys.TRANSPORT_STOP, f),
                                    this.listenTo(m, m.EventKeys.TRANSPORT_CLEAR, this.onClearBtnClick),
                                    this.listenTo(m, m.EventKeys.TRANSPORT_STOP, this.onSwingClick),
                                    this.listenTo(m, m.EventKeys.TRANSPORT_CHANGE_TEMPO, this.onIncomingTempoChange),
                                    e(document).on("keydown", this.keydown)
                            },
                            render: function () {
                                    var t = E();
                                    return e("body").on("touchend", this.outsideClickDetect),
                                    window.addEventListener("popstate", this.backButtonFunctionalityURL, !1),
                                    this.$el.html(t),
                                    this.$tempo = this.$el.find(".transport-tempo"),
                                    this.$ryd = this.$el.find(".clearBtn"),
                                    this
                            },
                            outsideClickDetect: function (t) {
                                    var n = t.target.className;
                                    "presetsBtn dropButton" != n && "preset-item" != n && e(".navigation-wrapper").find(".dropdown-content").removeClass("active"),
                                    "beatTime dropButton" != n && e(".navigation-wrapper-tact").find(".dropdown-content").removeClass("active")
                            },
                            backButtonFunctionalityURL: function () {
                                    window.location.href = document.referrer
                            },
                            onPlayClick: T,
                            onStopClick: f,
                            onTempoChange: function (a) {
                                    var i = e(a.currentTarget).val();
                                    o = i,
                                    r ? ("5/4" === t.rhythm || "6/8" === t.rhythm ? i /= .66666666666 : i /= 1.33, swingButton = "s.1") : (i = i, swingButton = "s.0"),
                                    c.splice(-3),
                                    c.push("t." + t.rhythm.slice(0, 1)),
                                    c.push("tmp." + o),
                                    c.push(swingButton),
                                    n = c,
                                    y(),
                                    m.trigger(m.EventKeys.TRANSPORT_TEMPO_CHANGED, i)
                            },
                            onIncomingTempoChange: function (e) {
                                    this.$tempo.val(e),
                                    o = e,
                                    m.trigger(m.EventKeys.TRANSPORT_TEMPO_CHANGED, e)
                            },
                            keydown: function (t) {
                                    var n = parseInt(e('input[name="tempo"]').val()),
                                            a = e("#play");
                                    32 === t.keyCode ? (t.preventDefault(), a.toggleClass("btn-play btn-pause"), a[0].classList.contains("btn-pause") ? m.trigger(m.EventKeys.TRANSPORT_PLAY, T) : e(t.currentTarget).find(".btn-play") && f()) : 37 === t.keyCode ? e('input[name="tempo"]').val(n - 1).change() : 39 === t.keyCode && e('input[name="tempo"]').val(n + 1).change()
                            },
                            onSwingClick: function (n) {
                                    e(".swing").toggleClass("swing-disabled"),
                                    r = !r;
                                    var a = e("#r-mid").find(".seq-row"),
                                            i = e(".sequencer-channels").find(".mute");
                                    a.each(function (n) {
                                            var a = "",
                                                    i = e(this).find("span");
                                            i.each(function (t) {
                                                    if (e(i[t]).hasClass("seq-note")) a += "1";
                                                    else if (e(i[t]).hasClass("seq-note-yellow")) a += "2";
                                                    else {
                                                            if (e(i[t]).hasClass("seq-note-empty")) return a;
                                                            a += "0"
                                                    }
                                            }),
                                            t.sequence[Object.keys(t.sequence)[n]] = a
                                    });
                                    var s = this.$tempo.val();
                                    r ? "5/4" === t.rhythm || "6/8" === t.rhythm ? newTempo = s / .66666666666 : newTempo = s / 1.33 : newTempo = s,
                                    t.muted = {},
                                    i.each(function (n) {
                                            e(this).hasClass("active") || (t.muted[n] = 1)
                                    }),
                                    m.trigger(m.EventKeys.SEQUENCER_SET_PATTERN, t),
                                    m.trigger(m.EventKeys.TRANSPORT_TEMPO_CHANGED, newTempo)
                            },
                            onClearBtnClick: function (a) {
                                    a.preventDefault(),
                                    "4/4" === t.rhythm ? t = u : "3/4" === t.rhythm ? t = p : "5/4" === t.rhythm ? t = v : "6/8" === t.rhythm && (t = g),
                                    this.$ryd.addClass("clearBtn-disabled"),
                                    i = 0,
                                    s = 0,
                                    c = [],
                                    n = [],
                                    e.ajax({
                                            url: l.url,
                                            type: "GET",
                                            success: function (e) {
                                                    window.history.pushState("", "", this.url + "")
                                            },
                                            error: function () {
                                                    console.log("There was a problem with the request.")
                                            }
                                    }),
                                    e(".presetsBtn").text(h.presetsButtonName),
                                    e(".preset_active").removeClass("active"),
                                    m.trigger(m.EventKeys.SEQUENCER_SET_PATTERN_FROM_TACT, t)
                            },
                            onSetBeatClick: function (n) {
                                    n.preventDefault(),
                                    r = !1;
                                    var a = e("#play");
                                    this.$ryd.addClass("clearBtn-disabled"),
                                    this.beat = n.currentTarget.dataset.beat,
                                    e(".set-beat").removeClass("active"),
                                    e(".preset_active").removeClass("active"),
                                    e(n.currentTarget).toggleClass("active"),
                                    e(n.currentTarget).parent().parent().removeClass("active"),
                                    e(".beatTime").text(this.beat + h.tact);
                                    var i = this.$tempo.val();
                                    switch (e(".presetsBtn").text(h.presetsButtonName), a[0].classList.contains("btn-pause") && (f(), T()), this.beat) {
                                    case "3/4":
                                            t = p;
                                            break;
                                    case "4/4":
                                            t = u;
                                            break;
                                    case "5/4":
                                            t = v;
                                            break;
                                    case "6/8":
                                            t = g
                                    }
                                    c = [],
                                    y(),
                                    m.trigger(m.EventKeys.SEQUENCER_SET_PATTERN_FROM_TACT, t),
                                    m.trigger(m.EventKeys.TRANSPORT_TEMPO_CHANGED, i)
                            },
                            onSetBeatOut: function (t) {
                                    d || e(t.currentTarget).find(".dropdown-content").removeClass("active")
                            },
                            onSetBeatIn: function (t) {
                                    d || e(t.currentTarget).find(".dropdown-content").addClass("active")
                            },
                            onBeatClick: function (t) {
                                    e(t.currentTarget).parent().find(".dropdown-content").toggleClass("active")
                            }
                    });
                    return {
                            init: function (e) {
                                    m.register(a),
                                    new w(e).render()
                            }
                    }
            }(),
            g = function () {
                    var t = {
                            PRESET_SELECTED: "preset:selected"
                    },
                            n = {
                                    "Pop/rock 1": {
                                            tempo: 90,
                                            name: "Pop/rock 1",
                                            sequence: {
                                                    hihatfod: "0000000000000000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "0000000000000000",
                                                    hihat: "1010101010101010",
                                                    lilletromme: "0000100000001000",
                                                    stortromme: "1000000010000000"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "4/4"
                                    },
                                    "Pop/rock 2": {
                                            tempo: 90,
                                            name: "Pop/rock 2",
                                            sequence: {
                                                    hihatfod: "0000000000000000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "0000000000000000",
                                                    hihat: "1010101010101010",
                                                    lilletromme: "0000100000001000",
                                                    stortromme: "1000000010100000"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "4/4"
                                    },
                                    "Pop/rock 3": {
                                            tempo: 90,
                                            name: "Pop/rock 3",
                                            sequence: {
                                                    hihatfod: "0000000000000000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "0000000000000000",
                                                    hihat: "1010101010101010",
                                                    lilletromme: "0000100000001000",
                                                    stortromme: "1000001010000000"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "4/4"
                                    },
                                    "Pop/rock 4": {
                                            tempo: 90,
                                            name: "Pop/rock 4",
                                            sequence: {
                                                    hihatfod: "0000000000000000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "0000000000000000",
                                                    hihat: "1010101010101010",
                                                    lilletromme: "0000100000001000",
                                                    stortromme: "1000001000100000"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "4/4"
                                    },
                                    "Pop/rock 5": {
                                            tempo: 90,
                                            name: "Pop/rock 5",
                                            sequence: {
                                                    hihatfod: "0000000000000000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "0000000000000000",
                                                    hihat: "1010101010101010",
                                                    lilletromme: "0000100000001000",
                                                    stortromme: "1000000100100000"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "4/4"
                                    },
                                    "Pop/rock 6": {
                                            tempo: 90,
                                            name: "Pop/rock 6",
                                            sequence: {
                                                    hihatfod: "0000000000000000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "0000000000000000",
                                                    hihat: "1010101010101010",
                                                    lilletromme: "0000100000001000",
                                                    stortromme: "0010000010000000"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "4/4"
                                    },
                                    "Pop/rock i 3/4": {
                                            tempo: 110,
                                            name: "Pop/rock i 3/4",
                                            sequence: {
                                                    hihatfod: "000000000000",
                                                    sidetamlys: "000000000000",
                                                    gulvtam: "000000000000",
                                                    ride: "000000000000",
                                                    hihat: "101010101010",
                                                    lilletromme: "000000001000",
                                                    stortromme: "100000100000"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "3/4"
                                    },
                                    "Pop/rock i 6/8": {
                                            tempo: 90,
                                            name: "Pop/rock i 6/8",
                                            sequence: {
                                                    hihatfod: "000000000000",
                                                    sidetamlys: "000000000000",
                                                    gulvtam: "000000000000",
                                                    ride: "000000000000",
                                                    hihat: "101010101010",
                                                    lilletromme: "000000100000",
                                                    stortromme: "100000000000"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "6/8"
                                    },
                                    "Jazz 1": {
                                            tempo: 110,
                                            name: "Jazz 1",
                                            sequence: {
                                                    hihatfod: "0000100000001000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "1000101010001010",
                                                    hihat: "0000000000000000",
                                                    lilletromme: "0000000000000000",
                                                    stortromme: "0000000000000000"
                                            },
                                            muted: {},
                                            swing: !0,
                                            rhythm: "4/4"
                                    },
                                    "Jazz 2": {
                                            tempo: 110,
                                            name: "Jazz 2",
                                            sequence: {
                                                    hihatfod: "0000100000001000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "1000101010001010",
                                                    hihat: "0000000000000000",
                                                    lilletromme: "0000000000001000",
                                                    stortromme: "1000000000000000"
                                            },
                                            muted: {},
                                            swing: !0,
                                            rhythm: "4/4"
                                    },
                                    "Jazz 3": {
                                            tempo: 110,
                                            name: "Jazz 3",
                                            sequence: {
                                                    hihatfod: "0000100000001000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "1000101010001010",
                                                    hihat: "0000000000000000",
                                                    lilletromme: "0000000000100000",
                                                    stortromme: "0000001000000000"
                                            },
                                            muted: {},
                                            swing: !0,
                                            rhythm: "4/4"
                                    },
                                    "Jazz 4": {
                                            tempo: 110,
                                            name: "Jazz 4",
                                            sequence: {
                                                    hihatfod: "0000100000001000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "1010101010101010",
                                                    hihat: "0000000000000000",
                                                    lilletromme: "0020000000002000",
                                                    stortromme: "1000000010000000"
                                            },
                                            muted: {},
                                            swing: !0,
                                            rhythm: "4/4"
                                    },
                                    "Funk 1": {
                                            tempo: 110,
                                            name: "Funk 1",
                                            sequence: {
                                                    hihatfod: "0000000000000000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "0000000000000000",
                                                    hihat: "1010101010101010",
                                                    lilletromme: "0000100101001100",
                                                    stortromme: "1000000000100001"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "4/4"
                                    },
                                    "Funk 2": {
                                            tempo: 90,
                                            name: "Funk 2",
                                            sequence: {
                                                    hihatfod: "0000000000000000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "0000000000000000",
                                                    hihat: "1111112111111121",
                                                    lilletromme: "0000100101011000",
                                                    stortromme: "1010000010100100"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "4/4"
                                    },
                                    "Disco 1": {
                                            tempo: 90,
                                            name: "Disco 1",
                                            sequence: {
                                                    hihatfod: "0000000000000000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "0000000000000000",
                                                    hihat: "1020102010201020",
                                                    lilletromme: "0000100000001000",
                                                    stortromme: "1000100010001000"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "4/4"
                                    },
                                    "Disco 2": {
                                            tempo: 110,
                                            name: "Disco 2",
                                            sequence: {
                                                    hihatfod: "0000000000000000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "0000000000000000",
                                                    hihat: "1020101110201011",
                                                    lilletromme: "0000100000001000",
                                                    stortromme: "1000100010001000"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "4/4"
                                    },
                                    "Rap 1": {
                                            tempo: 80,
                                            name: "Rap 1",
                                            sequence: {
                                                    hihatfod: "0000000000000000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "0000000000000000",
                                                    hihat: "0110101010101010",
                                                    lilletromme: "0000100000001000",
                                                    stortromme: "1010001001000000"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "4/4"
                                    },
                                    "Rap 2": {
                                            tempo: 90,
                                            name: "Rap 2",
                                            sequence: {
                                                    hihatfod: "0000000000000000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "0000000000000000",
                                                    hihat: "1010101010101020",
                                                    lilletromme: "0000100000001000",
                                                    stortromme: "1011011001100000"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "4/4"
                                    },
                                    "Heavy metal 1": {
                                            tempo: 90,
                                            name: "Heavy metal 1",
                                            sequence: {
                                                    hihatfod: "0000000000000000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "0000000000000000",
                                                    hihat: "2020202020202020",
                                                    lilletromme: "0000100000001010",
                                                    stortromme: "1011001111000001"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "4/4"
                                    },
                                    "Heavy metal 2": {
                                            tempo: 90,
                                            name: "Heavy metal 2",
                                            sequence: {
                                                    hihatfod: "0000000000000000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "0000000000000000",
                                                    hihat: "2020202020202020",
                                                    lilletromme: "0000100000001000",
                                                    stortromme: "1110001110010011"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "4/4"
                                    }
                            },
                            a = 0;
                    _.forOwn(n, function (e) {
                            a += 1,
                            e.name = h.presets[a]
                    });
                    var i = Handlebars.compile('            <ul id="myDropdown" class="presets menu dropdown-content">            {{#each items}}            <li><a href="#" data-preset-id="{{ @key }}" class="preset-item">{{ name }}</a></li>            {{/each}}            </ul>        '),
                            s = Backbone.View.extend({
                                    events: {
                                            "click a": "onPresetClick"
                                    },
                                    render: function () {
                                            var e = i({
                                                    items: n
                                            });
                                            return this.$el.html(e),
                                            this.$items = this.$el.find("a"),
                                            this
                                    },
                                    onPresetClick: function (t) {
                                            t.preventDefault();
                                            var a = e(t.currentTarget).text(),
                                                    i = e(t.currentTarget).attr("data-preset-id"),
                                                    s = n[i].rhythm,
                                                    o = n[i].swing,
                                                    l = n[i].tempo;
                                            o ? (l /= 1.33, r = !0) : r = !1,
                                            this.$items.removeClass("preset_active active"),
                                            e(".set-beat").removeClass("active"),
                                            e(t.currentTarget).parent().parent().removeClass("active"),
                                            e(t.currentTarget).addClass("preset_active active"),
                                            e(".presetsBtn").text(a),
                                            e(".beatTime").text(s + h.tact),
                                            e(".clearBtn").removeClass("clearBtn-disabled"),
                                            m.trigger(m.EventKeys.PRESET_SELECTED, n[i]),
                                            m.trigger(m.EventKeys.TRANSPORT_TEMPO_CHANGED, l)
                                    }
                            });
                    return {
                            init: function (e) {
                                    m.register(t),
                                    new s(e).render()
                            }
                    }
            }();

    function E(e) {
            var t, n, a, i, s = e.indexOf("?") + 1,
                    r = e.indexOf("#") + 1 || e.length + 1,
                    o = e.slice(s, r - 1),
                    l = o.replace(/\+/g, " ").split("&"),
                    h = {};
            if (o === e || "" === o) return !1;
            for (t = 0; t < l.length; t++) i = l[t].split("=", 2),
            n = decodeURIComponent(i[0]),
            a = decodeURIComponent(i[1]),
            h.hasOwnProperty(n) || (h[n] = []),
            h[n].push(2 === i.length ? a : null);
            return h
    }
    function y() {
            var t = JSON.stringify(c.join("-"));
            e.ajax({
                    url: l.url,
                    type: "GET",
                    data: {
                            data: t
                    },
                    success: function (e) {
                            window.history.pushState("", "", this.url + "")
                    },
                    error: function () {
                            console.log("There was a problem with the request.")
                    }
            })
    }({
            _connectModules: function () {
                    m.on(m.EventKeys.TRANSPORT_REQUEST_PLAY, function () {
                            m.trigger(m.EventKeys.SEQUENCER_PLAY)
                    }),
                    m.on(m.EventKeys.TRANSPORT_REQUEST_STOP, function () {
                            m.trigger(m.EventKeys.SEQUENCER_STOP)
                    }),
                    m.on(m.EventKeys.TRANSPORT_REQUEST_MUTE, function (e) {
                            m.trigger(m.EventKeys.SEQUENCER_SET_PATTERN, e)
                    }),
                    m.on(m.EventKeys.TRANSPORT_TEMPO_CHANGED, function (e) {
                            m.trigger(m.EventKeys.SEQUENCER_SET_TEMPO, e)
                    }),
                    m.on(m.EventKeys.PRESET_SELECTED, function (e) {
                            m.trigger(m.EventKeys.TRANSPORT_CHANGE_TEMPO, e.tempo),
                            m.trigger(m.EventKeys.SEQUENCER_SET_PATTERN, e)
                    })
            },
            onLoad: function () {
                    var t;
                    E(window.location.href).data && (t = JSON.parse(E(window.location.href).data), n = t.split("-")),
                    this._connectModules();
                    var a = {
                            tempo: 90,
                            sequence: {
                                    hihatfod: "0000000000000000",
                                    sidetamlys: "0000000000000000",
                                    gulvtam: "0000000000000000",
                                    ride: "0000000000000000",
                                    hihat: "1010101010101010",
                                    lilletromme: "0000100000001000",
                                    stortromme: "1000000010000000"
                            },
                            muted: {},
                            swing: !1,
                            rhythm: "4/4"
                    };
                    if (n) {
                            switch (n.slice(-3)[0].slice(2, 3)) {
                            case "3":
                                    a = {
                                            tempo: 90,
                                            sequence: {
                                                    hihatfod: "000000000000",
                                                    sidetamlys: "000000000000",
                                                    gulvtam: "000000000000",
                                                    ride: "000000000000",
                                                    hihat: "000000000000",
                                                    lilletromme: "000000000000",
                                                    stortromme: "000000000000"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "3/4"
                                    };
                                    break;
                            case "4":
                                    a = {
                                            tempo: 90,
                                            sequence: {
                                                    hihatfod: "0000000000000000",
                                                    sidetamlys: "0000000000000000",
                                                    gulvtam: "0000000000000000",
                                                    ride: "0000000000000000",
                                                    hihat: "0000000000000000",
                                                    lilletromme: "0000000000000000",
                                                    stortromme: "0000000000000000"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "4/4"
                                    };
                                    break;
                            case "5":
                                    a = {
                                            tempo: 90,
                                            sequence: {
                                                    hihatfod: "0000000000",
                                                    sidetamlys: "0000000000",
                                                    gulvtam: "0000000000",
                                                    ride: "0000000000",
                                                    hihat: "0000000000",
                                                    lilletromme: "0000000000",
                                                    stortromme: "0000000000"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "5/4"
                                    };
                                    break;
                            case "6":
                                    a = {
                                            tempo: 90,
                                            sequence: {
                                                    hihatfod: "000000000000",
                                                    sidetamlys: "000000000000",
                                                    gulvtam: "000000000000",
                                                    ride: "000000000000",
                                                    hihat: "000000000000",
                                                    lilletromme: "000000000000",
                                                    stortromme: "000000000000"
                                            },
                                            muted: {},
                                            swing: !1,
                                            rhythm: "6/8"
                                    }
                            }
                            2 === n.length && (a = a);
                            var i = Object.values(a.sequence),
                                    s = Object.keys(a.sequence);
                            i.forEach(function (t, i) {
                                    n.forEach(function (n, s) {
                                            var r = parseInt(n.split(".")[0]),
                                                    l = parseInt(n.split(".")[1]),
                                                    h = parseInt(n.split(".")[2]),
                                                    c = n.toString().split(".")[0],
                                                    m = t.split("");
                                            if (i === r && (m.forEach(function (e) {
                                                    m[l] = h + ""
                                            }), t = m.join("")), "s" == c && 1 == l) a.swing = !0;
                                            else if ("tmp" == c) o = l,
                                            e('input[name="tempo"]').val(o);
                                            else if ("m" === c) {
                                                    var d = n.split(".")[1];
                                                    for (var u in d) a.muted[d[u]] = 1
                                            }
                                    }),
                                    a.sequence[s[i]] = t
                            })
                    }
                    e(".beatTime").text(a.rhythm + h.tact),
                    m.trigger(m.EventKeys.SEQUENCER_SET_PATTERN, a),
                    m.trigger(m.EventKeys.TRANSPORT_TEMPO_CHANGED, o),
                    a.swing && m.trigger(m.EventKeys.TRANSPORT_STOP, this.onSwingClick)
            },
            init: function () {
                    document.addEventListener("visibilitychange", function (e) {
                            document.hidden && m.trigger(m.EventKeys.SEQUENCER_STOP)
                    }, !1);
                    var t = {};
                    ["hihatfod", "sidetamlys", "gulvtam", "ride", "hihat", "kantslag", "stortromme", "aabenhihat", "lilletromme", "sidetamdyb"].forEach(function (e) {
                            t[e] = l.pathToSoundFiles + e + ".mp3"
                    }),
                    p.init({
                            el: e("#r-mid")
                    }),
                    v.init({
                            el: e("#r-top")
                    }),
                    g.init({
                            el: e(".navigation")
                    }),
                    u.init(t, this.onLoad.bind(this))
            }
    }).init(),
    e("input").on("change", function () {
            var e = Math.abs(parseInt(this.value, 10) || 1);
            this.value = e > 999 ? 999 : e
    })
});

document.addEventListener('DOMContentLoaded', function() {
        const volumeSlider = document.getElementById('masterVolume');
        const volumeValue = volumeSlider.nextElementSibling;
        
        //       
        function setMasterVolume(value) {
            const normalizedValue = value / 100; //    0-1
            //       -
            const audioElements = document.querySelectorAll('audio');
            audioElements.forEach(audio => {
                audio.volume = normalizedValue;
            });
            //   
            volumeValue.textContent = value + '%';
        }
    
        //    
        volumeSlider.addEventListener('input', function() {
            setMasterVolume(this.value);
        });
    
        //   
        setMasterVolume(volumeSlider.value);
    });

    // Volume control
document.getElementById('volumeControl').addEventListener('input', (e) => {
        globalVolume = e.target.value / 100;
        document.getElementById('volumeValue').textContent = `${e.target.value}%`;
    });